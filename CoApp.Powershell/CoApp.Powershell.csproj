<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProjectGuid>{C417049A-3DA0-4F3B-A561-FEAF4BE53BD3}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>CoApp.Powershell</RootNamespace>
    <AssemblyName>CoApp.Powershell</AssemblyName>
    <TargetFrameworkVersion>v4.0</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <SolutionDir Condition="$(SolutionDir) == '' Or $(SolutionDir) == '*Undefined*'">..\</SolutionDir>
    <RestorePackages>true</RestorePackages>
  </PropertyGroup>
  <Import Project="$(SolutionDir)\CoApp.Powershell.sln.props" Condition="Exists('$(SolutionDir)\CoApp.Powershell.sln.props')" />
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="ClrPlus.Core">
      <HintPath>..\packages\ClrPlus.Core.1.8.0.61\lib\net40\ClrPlus.Core.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Platform">
      <HintPath>..\packages\ClrPlus.Platform.1.8.0.61\lib\net40\ClrPlus.Platform.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Powershell.Azure">
      <HintPath>..\packages\ClrPlus.Powershell.Azure.1.8.0.61\lib\net40\ClrPlus.Powershell.Azure.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Powershell.Core">
      <HintPath>..\packages\ClrPlus.Powershell.Core.1.8.0.61\lib\net40\ClrPlus.Powershell.Core.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Powershell.Provider">
      <HintPath>..\packages\ClrPlus.Powershell.Provider.1.8.0.61\lib\net40\ClrPlus.Powershell.Provider.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Powershell.Rest">
      <HintPath>..\packages\ClrPlus.Powershell.Rest.1.8.0.61\lib\net40\ClrPlus.Powershell.Rest.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Scripting">
      <HintPath>..\packages\ClrPlus.Scripting.1.8.0.61\lib\net40\ClrPlus.Scripting.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Scripting.MsBuild">
      <HintPath>..\packages\ClrPlus.Scripting.MsBuild.1.8.0.61\lib\net40\ClrPlus.Scripting.MsBuild.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Tasks">
      <HintPath>..\packages\ClrPlus.Tasks.1.8.0.36\lib\net40\ClrPlus.Tasks.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Windows.Api">
      <HintPath>..\packages\ClrPlus.Windows.Api.1.8.0.61\lib\net40\ClrPlus.Windows.Api.dll</HintPath>
    </Reference>
    <Reference Include="ClrPlus.Windows.PeBinary">
      <HintPath>..\packages\ClrPlus.Windows.PeBinary.1.8.0.61\lib\net40\ClrPlus.Windows.PeBinary.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.Analysis.ControlAndDataFlowGraph">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.Analysis.ControlAndDataFlowGraph.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.AstsProjectedAsCodeModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.AstsProjectedAsCodeModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.CodeModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.CodeModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.CodeModelToIL">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.CodeModelToIL.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.ContractExtractor">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.ContractExtractor.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.CSharpSourceEmitter">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.CSharpSourceEmitter.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.ILGenerator">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.ILGenerator.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.MetadataHelper">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.MetadataHelper.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.MetadataModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.MetadataModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.MutableCodeModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.MutableCodeModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.MutableMetadataModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.MutableMetadataModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.NewILToCodeModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.NewILToCodeModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.PdbReader">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.PdbReader.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.PdbWriter">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.PdbWriter.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.PeReader">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.PeReader.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.PeWriter">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.PeWriter.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.ReflectionEmitter">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.ReflectionEmitter.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.SourceEmitter">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.SourceEmitter.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Cci.SourceModel">
      <HintPath>..\packages\CCI.1.0.13\lib\net40\Microsoft.Cci.SourceModel.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.CompilerServices.AsyncTargetingPack.Net4">
      <HintPath>..\packages\Microsoft.CompilerServices.AsyncTargetingPack.1.0.0\lib\net40\Microsoft.CompilerServices.AsyncTargetingPack.Net4.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Data.Edm, Version=5.2.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\packages\Microsoft.Data.Edm.5.2.0\lib\net40\Microsoft.Data.Edm.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Data.OData, Version=5.2.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\packages\Microsoft.Data.OData.5.2.0\lib\net40\Microsoft.Data.OData.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Deployment.WindowsInstaller, Version=3.0.0.0, Culture=neutral, PublicKeyToken=ce35f76fcda82bad, processorArchitecture=MSIL">
      <HintPath>..\packages\DTF-Unofficial.3.6.2928\lib\Microsoft.Deployment.WindowsInstaller.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.PowerShell.Commands.Management, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\..\..\..\..\..\..\Program Files (x86)\Reference Assemblies\Microsoft\WindowsPowerShell\3.0\Microsoft.PowerShell.Commands.Management.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.WindowsAzure.Configuration">
      <HintPath>..\packages\Microsoft.WindowsAzure.ConfigurationManager.1.8.0.0\lib\net35-full\Microsoft.WindowsAzure.Configuration.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.WindowsAzure.Storage">
      <HintPath>..\packages\WindowsAzure.Storage.2.0.4.1\lib\net40\Microsoft.WindowsAzure.Storage.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack">
      <HintPath>..\packages\ServiceStack.3.9.38\lib\net35\ServiceStack.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.Common">
      <HintPath>..\packages\ServiceStack.Common.3.9.38\lib\net35\ServiceStack.Common.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.Interfaces">
      <HintPath>..\packages\ServiceStack.Common.3.9.38\lib\net35\ServiceStack.Interfaces.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.OrmLite">
      <HintPath>..\packages\ServiceStack.OrmLite.SqlServer.3.9.39\lib\ServiceStack.OrmLite.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.OrmLite.SqlServer">
      <HintPath>..\packages\ServiceStack.OrmLite.SqlServer.3.9.39\lib\ServiceStack.OrmLite.SqlServer.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.Redis">
      <HintPath>..\packages\ServiceStack.Redis.3.9.38\lib\net35\ServiceStack.Redis.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.ServiceInterface">
      <HintPath>..\packages\ServiceStack.3.9.38\lib\net35\ServiceStack.ServiceInterface.dll</HintPath>
    </Reference>
    <Reference Include="ServiceStack.Text">
      <HintPath>..\packages\ServiceStack.Text.3.9.38\lib\net35\ServiceStack.Text.dll</HintPath>
    </Reference>
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Data.Services.Client" />
    <Reference Include="System.Management.Automation, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\..\..\..\..\..\..\Program Files (x86)\Reference Assemblies\Microsoft\WindowsPowerShell\3.0\System.Management.Automation.dll</HintPath>
    </Reference>
    <Reference Include="System.Runtime.Serialization" />
    <Reference Include="System.Spatial, Version=5.2.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, processorArchitecture=MSIL">
      <SpecificVersion>False</SpecificVersion>
      <HintPath>..\packages\System.Spatial.5.2.0\lib\net40\System.Spatial.dll</HintPath>
    </Reference>
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.Data" />
    <Reference Include="System.Xml" />
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="WindowsBase" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="AssemblyStrongName.cs" />
    <Compile Include="Commands\GetPublicCertificate.cs" />
    <Compile Include="Commands\InvokeBuildCmdlet.cs" />
    <Compile Include="Commands\SetCodeSignature.cs" />
    <Compile Include="Commands\ShowCoAppToolsVersion.cs" />
    <Compile Include="Commands\WriteNugetPackage.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
    <Compile Include="Signers\AuthenticodeSigner.cs" />
    <Compile Include="Signers\OPCSigner.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Include="CoApp.psd1">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="packages.config" />
    <None Include="etc\basic.autopkg">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Include="zlib.autopkg">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  <ItemGroup>
    <None Include="etc\autopackage.targets" />
    <Content Include="etc\NuGet.exe">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </Content>
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <Import Project="$(SolutionDir)\.nuget\NuGet.targets" Condition="Exists('$(SolutionDir)\.nuget\NuGet.targets')" />
  <PropertyGroup>
    <AssemblySearchPaths>$(SolutionDir)..\ClrPlus\$(OutputRelativePath);$(AssemblySearchPaths)</AssemblySearchPaths>
  </PropertyGroup>
  <PropertyGroup>
    <PostBuildEvent>cd $(TargetDir)
    
$(SolutionDir)\tools\il-repack.exe /out:CoApp.Powershell.Tools.dll CoApp.Powershell.dll ClrPlus.Core.dll ClrPlus.Platform.dll ClrPlus.Powershell.Azure.dll ClrPlus.Powershell.Core.dll ClrPlus.Powershell.Provider.dll ClrPlus.Powershell.Rest.dll ClrPlus.Scripting.dll ClrPlus.Scripting.MsBuild.dll ClrPlus.Tasks.dll ClrPlus.Windows.Api.dll ClrPlus.Windows.PeBinary.dll Microsoft.Cci.Analysis.ControlAndDataFlowGraph.dll Microsoft.Cci.AstsProjectedAsCodeModel.dll Microsoft.Cci.CodeModel.dll Microsoft.Cci.CodeModelToIL.dll Microsoft.Cci.ContractExtractor.dll Microsoft.Cci.CSharpSourceEmitter.dll Microsoft.Cci.ILGenerator.dll Microsoft.Cci.MetadataHelper.dll Microsoft.Cci.MetadataModel.dll Microsoft.Cci.MutableCodeModel.dll Microsoft.Cci.MutableMetadataModel.dll Microsoft.Cci.NewILToCodeModel.dll Microsoft.Cci.PdbReader.dll Microsoft.Cci.PdbWriter.dll Microsoft.Cci.PeReader.dll Microsoft.Cci.PeWriter.dll Microsoft.Cci.ReflectionEmitter.dll Microsoft.Cci.SourceEmitter.dll Microsoft.Cci.SourceModel.dll Microsoft.CompilerServices.AsyncTargetingPack.Net4.dll Microsoft.WindowsAzure.Configuration.dll Microsoft.WindowsAzure.Storage.dll ServiceStack.Common.dll ServiceStack.dll ServiceStack.Interfaces.dll ServiceStack.ServiceInterface.dll ServiceStack.Text.dll  ServiceStack.OrmLite.dll Microsoft.Deployment.WindowsInstaller.dll

"C:\Program Files (x86)\Windows Kits\8.0\bin\x86\signtool.exe" sign /a /t http://timestamp.verisign.com/scripts/timstamp.dll $(TargetDir)\CoApp.Powershell.Tools.dll

</PostBuildEvent>
  </PropertyGroup>
  <PropertyGroup>
    <PreBuildEvent>@echo on
@setlocal 

set SLNDIR=$(SolutionDir)

set TOOLSDIR=$(SolutionDir)\tools
set NODE_PATH=%25TOOLSDIR%25\node
path = %25TOOLSDIR%25;%25NODE_PATH%25\node_modules\.bin;%25PATH%25

set NPM=call npm
set REPLACE=replace.cmd


node $(SolutionDir)\tools\incver.js $(SolutionDir)\version.txt

for /F %25%25v in ($(SolutionDir)\version.txt) do set NEWVER=%25%25v
echo %25NEWVER%25

call replace.cmd "\[assembly: AssemblyVersion.*" "[assembly: AssemblyVersion(""%25NEWVER%25"")]" %25SLNDIR%25\CoApp.Powershell\assemblystrongname.cs
call replace.cmd "\[assembly: AssemblyFileVersion.*" "[assembly: AssemblyFileVersion(""%25NEWVER%25"")]" %25SLNDIR%25\CoApp.Powershell\assemblystrongname.cs

call replace.cmd ".Product.Id=""\*"".Name=""CoApp.Powershell.*" "&lt;Product Id=""*"" Name=""CoApp.Powershell (v%25NEWVER%25)"" Language=""1033"" Version=""%25NEWVER%25"" Manufacturer=""Outercurve Foundation, CoApp Project"" UpgradeCode=""a43c25d7-b22a-411c-b780-3a83479b1d26""&gt;" %25SLNDIR%25\Installer\Product.wxs
call replace.cmd ".UpgradeVersion.OnlyDetect=""no"".*" "&lt;UpgradeVersion OnlyDetect=""no"" Property=""PREVIOUSFOUND"" Minimum=""1.0.0"" IncludeMinimum=""yes"" Maximum=""%25NEWVER%25"" IncludeMaximum=""no""&gt;&lt;/UpgradeVersion&gt;" %25SLNDIR%25\Installer\Product.wxs</PreBuildEvent>
  </PropertyGroup>
  <!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
       Other similar extension points exist, see Microsoft.Common.targets.
  <Target Name="BeforeBuild">
  </Target>
  <Target Name="AfterBuild">
  </Target>
  -->
</Project>